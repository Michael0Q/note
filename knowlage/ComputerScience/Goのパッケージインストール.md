# Go のパッケージ管理とコマンド (`go get` / `go install`)

Go のパッケージ管理は、**Go Modules**の導入によって大きく変わりました。現代の Go 開発では、`go get`と`go install`という 2 つのコマンドの役割を正しく理解し、使い分けることが重要です。

## 1. `go get` vs `go install`: 役割の分離

かつて`go get`は、依存関係の取得とコマンド（実行可能ファイル）のインストールの両方を担っていました。しかし、これは開発者の混乱を招く原因となっていました。「ライブラリのバージョンを更新したいだけなのに、コマンドがインストールされてしまう」またはその逆、といった意図しない動作が起こり得たのです。

この問題を解決するため、Go 1.17 からそれぞれの役割が明確に分離されました。

- **`go install`**: **コマンド（実行可能ファイル）をビルドしてインストールする**ためのコマンド。
- **`go get`**: プロジェクトの依存関係（ライブラリ）を **`go.mod` ファイルで管理する**ためのコマンド。

## 2. `go install`: コマンドのインストール

`go install`は、`main`パッケージをコンパイルし、生成された実行可能ファイルを`$GOPATH/bin`（または`$GOBIN`が設定されていればそのディレクトリ）に配置します。これにより、インストールされたコマンドをシステムのどこからでも実行できるようになります。

### 使い方 1: 特定のバージョンをインストールする (推奨)

```sh
# 最新バージョンをインストール
go install golang.org/x/tools/gopls@latest

# 特定のバージョンをインストール
go install github.com/go-delve/delve/cmd/dlv@v1.22.1
```

`@` に続けてバージョンや `latest` を指定する方法は、現在のプロジェクトの`go.mod`の影響を受けずにツールをインストールするための**最も推奨される方法**です。グローバルに利用したい開発ツール（リンター、デバッガーなど）のインストールに最適です。

### 使い方 2: プロジェクトの依存関係としてインストールする

```sh
# go.mod に記載されたバージョンに基づいてインストール
go install example.com/path/to/cmd
```

バージョンを指定しない場合、`go install`は現在のモジュールの`go.mod`ファイルに記載された依存関係や`replace`ディレクティブを考慮してビルド・インストールを行います。プロジェクト固有のツールをインストールする場合に便利です。

## 3. `go get`: 依存関係の管理

`go get`の現在の主な役割は、**`go.mod`ファイルを編集してプロジェクトの依存関係を更新する**ことです。コマンドを実行すると、`go.mod`内の`require`ブロックが変更されます。

### 使い方 1: 新しい依存関係を追加する

```sh
# 最新バージョンのパッケージを go.mod に追加
go get github.com/google/uuid
```

### 使い方 2: 依存関係を更新・変更する

```sh
# マイナーバージョンとパッチバージョンを最新に更新
go get -u github.com/google/uuid

# 特定のバージョンを指定
go get github.com/google/uuid@v1.5.0
```

### 使い方 3: 依存関係を削除する

依存関係を削除する最も確実な方法は、ソースコードから`import`文を削除し、`go mod tidy`を実行することです。

```sh
# 1. hello.go から "github.com/google/uuid" の import 文を削除

# 2. tidyコマンドを実行して、不要になった依存関係を go.mod から削除
go mod tidy
```

`go get`を使って明示的に削除することも可能ですが、`go mod tidy`の方がプロジェクト全体を見て判断するため、より安全で確実です。

```sh
# @none を指定すると依存関係から削除される
go get github.com/google/uuid@none
```

## 4. まとめ

| やりたいこと                                           | 推奨コマンド                     | 説明                                                                     |
| ------------------------------------------------------ | -------------------------------- | ------------------------------------------------------------------------ |
| **開発ツール（リンター等）をインストールしたい**       | `go install <package>@latest`    | `go.mod`に影響を与えずに、グローバルなコマンドとしてインストールします。 |
| **プロジェクトに新しいライブラリを追加したい**         | `go get <package>`               | `go.mod`に新しい依存関係を追加し、パッケージをダウンロードします。       |
| **既存のライブラリを最新バージョンに更新したい**       | `go get -u <package>`            | `go.mod`に記載されたパッケージのバージョンを更新します。                 |
| **プロジェクトで使わなくなったライブラリを整理したい** | `go mod tidy`                    | ソースコードを静的解析し、不要な依存関係を`go.mod`から一掃します。       |
| **特定のバージョンのツールを使いたい**                 | `go install <package>@<version>` | 指定したバージョンのコマンドをインストールします。                       |
| **特定のバージョンのライブラリを使いたい**             | `go get <package>@<version>`     | `go.mod`の依存関係を特定のバージョンに固定します。                       |
